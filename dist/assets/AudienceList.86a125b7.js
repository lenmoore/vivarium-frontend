import{_ as re,u as ie,h as f,f as ce,g as S,l as me,e as ae,w as de,r as _e,o as l,a as s,m as Q,q as L,p as g,i as o,n as v,k as n,F as k,j as b,s as A,t as h,aL as he,aJ as pe}from"./index.73886189.js";import{u as ye}from"./humanity-shop.store.daff031c.js";const ue=q=>(he("data-v-1478665e"),q=q(),pe(),q),fe={class:"my-4"},ge=ue(()=>o("br",null,null,-1)),ve={class:"d-flex justify-content-around align-items-center"},ke={key:0},be={class:"d-flex align-items-center justify-content-around"},we={key:0},xe={key:0,class:"visitors"},ze={class:"border-top"},Se={key:1},Ce={key:0,class:"d-flex m-1 p-1 align-items-center"},Pe=["src"],Qe={class:"m-1 p-1"},Le={key:2},qe={key:3},Ve=ue(()=>o("h4",{style:{"margin-top":"20rem"}}," \xC4ra vajuta neid nuppe, kui sul siia asja pole. Helena paneb need hiljem peitu ",-1)),Ge={__name:"AudienceList",setup(q){const y=ie(),B=ye();let i=f({showSummaryList:!0,showProductsSummary:!1,showQuizSummaryInCapsule:!1,showQuizSummaryPreCapsule:!1,ready:!1});ce(async()=>{await y.getGames(),await B.fetchBaskets(),await y.getPerformances();const _=S(()=>y.getActivePerformance);await y.getCurrentPerformanceVisitors(_.value._id)});const le=S(()=>B.getBaskets),se=S(()=>B.getProducts);let C=S(()=>y.games),H=S(()=>y.games),w=f(me.currentRoute.value.query.color),V=S(()=>y.getVisitors);function G(_){switch(i.value.showSummaryList=!1,i.value.showProductsSummary=!1,i.value.showQuizSummaryPreCapsule=!1,i.value.showQuizSummaryInCapsule=!1,_){case"products":i.value.showProductsSummary=!0;break;case"quiz-in-capsule":i.value.showQuizSummaryInCapsule=!0;break;case"quiz-pre-capsule":i.value.showQuizSummaryPreCapsule=!0;break;case"audience":default:i.value.showSummaryList=!0;break}}let M=f([]),d=f([]),x=ae([]),I=f([]);de(V,async()=>{let _=[];M=f([]),d=f([]),x=ae([]),I=f([]),w.value?_=f(V.value.filter(t=>t.confirmed_humanity_value===w.value)):_=f(V.value),x=_.value.map(t=>{var N,O,T,$,F,K,D,J,U,W,X,Y,Z,R,ee,te;let e=t.basket,m=t.quiz_results?(O=(N=t==null?void 0:t.quiz_results)==null?void 0:N.map(a=>{var u,P;return((u=a.result_humanity_values)==null?void 0:u.fuchsia)||((P=a.result_humanity_values)==null?void 0:P.red)}))==null?void 0:O.reduce((a,u)=>a+u):[],c=t.quiz_results?($=(T=t==null?void 0:t.quiz_results)==null?void 0:T.map(a=>{var u;return(u=a==null?void 0:a.result_humanity_values)==null?void 0:u.green}))==null?void 0:$.reduce((a,u)=>a+u):[],p=t.quiz_results?(K=(F=t==null?void 0:t.quiz_results)==null?void 0:F.map(a=>{var u;return(u=a==null?void 0:a.result_humanity_values)==null?void 0:u.blue}))==null?void 0:K.reduce((a,u)=>a+u):[],z=t.quiz_results?(J=(D=t==null?void 0:t.quiz_results)==null?void 0:D.map(a=>{var u;return(u=a==null?void 0:a.result_humanity_values)==null?void 0:u.orange}))==null?void 0:J.reduce((a,u)=>a+u):[],E=[{color:"fuchsia",val:((W=(U=e==null?void 0:e.products)==null?void 0:U.map(a=>{var u,P;return(P=(u=a.humanity_values)==null?void 0:u.fuchsia)==null?void 0:P.average}))==null?void 0:W.reduce((a,u)=>a+u))+m},{color:"lime",val:((Y=(X=e==null?void 0:e.products)==null?void 0:X.map(a=>a.humanity_values.green.average))==null?void 0:Y.reduce((a,u)=>a+u))+c},{color:"silver",val:((R=(Z=e==null?void 0:e.products)==null?void 0:Z.map(a=>a.humanity_values.blue.average))==null?void 0:R.reduce((a,u)=>a+u))+p},{color:"blue-sky",val:((te=(ee=e==null?void 0:e.products)==null?void 0:ee.map(a=>a.humanity_values.orange.average))==null?void 0:te.reduce((a,u)=>a+u))+z}];if(t.quiz_results.forEach(a=>{console.log(a),I.value.push(a)}),t.confirmed_humanity_value!=="none")return{...t,basket:e,avg_hum_values:E};let j=E.find(a=>a.val===Math.max(...E.map(u=>u.val)));return console.log("Highest: ",j==null?void 0:j.color),{...t,basket:e,avg_hum_values:E,highest:j}}),await oe(x),await y.getGames(),C=S(()=>y.games),H=C.value.filter(t=>t.open_for_colors.length===4&&t.game_type!=="SHOP"),console.log("`G G G G G GAMES",H);let r={"blue-sky":"orange",fuchsia:"fuchsia",silver:"blue",lime:"green"}[w.value||"all"];C=C.value.filter(t=>t.open_for_colors.includes(r)&&t.open_for_colors.length===1)});async function ne(){console.log(x),console.log(x.length);let _=[];x.forEach(r=>{console.log(r),(r.confirmed_humanity_value==="none"||!r.confirmed_humanity_value)&&_.push({...r,confirmed_humanity_value:r.highest.color})}),console.log(_),await y.updateVisitors(_),location.reload()}async function oe(_){var r;_.forEach(t=>{var e,m;(m=(e=t.basket)==null?void 0:e.products)==null||m.forEach(c=>{M.value.push(c)})}),se.value.forEach(t=>{var m,c;let e=M.value.filter(p=>p._id===t._id).length;(m=d==null?void 0:d.value)!=null&&m.find(p=>p._id===t._id)||(c=d==null?void 0:d.value)==null||c.push({...t,count:e})}),console.log(d),d.value=(r=d==null?void 0:d.value)==null?void 0:r.sort((t,e)=>e.count-t.count),i.value.ready=!0}return(_,r)=>{const t=_e("RouterLink");return l(),s("div",fe,[Q(t,{to:{name:"admin.audience"},class:"mx-2"},{default:L(()=>[g("Publik k\xF5ik ")]),_:1},8,["to"]),ge,o("div",ve,[Q(t,{class:v([{"font-size-xl":n(w)==="blue-sky"},"mx-2 p-2"]),to:{name:"admin.audience",query:{color:"blue-sky"}},style:{"background-color":"paleturquoise"}},{default:L(()=>[g(" T\xFCrkiis ")]),_:1},8,["class","to"]),Q(t,{class:v([{"font-size-xl":n(w)==="fuchsia"},"mx-2 p-2"]),to:{name:"admin.audience",query:{color:"fuchsia"}},style:{"background-color":"lightpink"}},{default:L(()=>[g(" Violett ")]),_:1},8,["class","to"]),Q(t,{class:v([{"font-size-xl":n(w)==="silver"},"mx-2 p-2"]),to:{name:"admin.audience",query:{color:"silver"}},style:{"background-color":"silver"}},{default:L(()=>[g(" H\xF5bevalge ")]),_:1},8,["class","to"]),Q(t,{class:v([{"font-size-xl":n(w)==="lime"},"mx-2 p-2"]),to:{name:"admin.audience",query:{color:"lime"}},style:{"background-color":"lime"}},{default:L(()=>[g(" Laim ")]),_:1},8,["class","to"])]),n(V)&&n(le)?(l(),s("div",ke,[o("div",be,[o("button",{class:v([{"bg-success text-white":n(i).showSummaryList},"btn btn-outline-primary"]),onClick:r[0]||(r[0]=e=>G("audience"))}," Publiku ulevaade ",2),o("button",{class:v([{"bg-success text-white":n(i).showProductsSummary},"btn btn-outline-primary"]),onClick:r[1]||(r[1]=e=>G("products"))}," K6ik tooted ",2),o("button",{class:v([{"bg-success text-white":n(i).showQuizSummaryPreCapsule},"btn btn-outline-primary"]),onClick:r[2]||(r[2]=e=>G("quiz-pre-capsule"))}," Quizi vastused enne kapslit ",2),o("button",{class:v([{"bg-success text-white":n(i).showQuizSummaryInCapsule},"btn btn-outline-primary"]),onClick:r[3]||(r[3]=e=>G("quiz-in-capsule"))}," Quizid kapslis ",2)]),n(i).ready?(l(),s("div",we,[n(i).showSummaryList?(l(),s("div",xe,[(l(!0),s(k,null,b(n(x),e=>(l(),s("div",{key:e._id,class:v([e.highest&&e.highest.color||e.confirmed_humanity_value,"visitor-wrapper mt-2 text-center"])},[o("h5",null,"Garderoobinumber: "+h(e.wardrobe_number),1),g(" Tooteid korvis: "+h(e.basket.products.length)+", "+h(e.confirmed_humanity_value||e.highest&&e.highest.color)+" ",1),o("div",ze,[g(" Korvis: "),(l(!0),s(k,null,b(e.basket.products,m=>(l(),s("small",{key:m.title},h(m.title)+", ",1))),128))])],2))),128))])):n(i).showProductsSummary&&n(d)?(l(),s("div",Se,[o("div",null,[(l(!0),s(k,null,b(n(d),e=>(l(),s("div",{key:e._id},[e.count>0?(l(),s("div",Ce,[o("img",{src:e.image,alt:"",height:"100"},null,8,Pe),o("h4",Qe,h(e.count)+" x "+h(e.title),1)])):A("",!0)]))),128))])])):n(i).showQuizSummaryInCapsule?(l(),s("div",Le,[(l(!0),s(k,null,b(n(C),(e,m)=>(l(),s("div",{key:e._id+m},[o("div",null,[o("h1",null,h(m)+" "+h(e.name),1),(l(!0),s(k,null,b(e.game_steps,c=>(l(),s("div",{key:c._id,class:"py-2"},[o("h4",null,h(c.question_text),1),(l(!0),s(k,null,b(c.question_options,p=>(l(),s("div",{key:p.option_text},[g(h(p.option_text)+" ",1),o("strong",null,"("+h(n(I).filter(z=>z.result_text===p.option_text&&z.step===c._id).length)+")",1)]))),128))]))),128))])]))),128))])):n(i).showQuizSummaryPreCapsule?(l(),s("div",qe,[(l(!0),s(k,null,b(n(H),(e,m)=>(l(),s("div",{key:e._id+m},[o("div",null,[(l(!0),s(k,null,b(e.game_steps,c=>(l(),s("div",{key:c._id,class:"py-2"},[o("h4",null,h(c.question_text),1),(l(!0),s(k,null,b(c.question_options,p=>(l(),s("div",{key:p.option_text},[g(h(p.option_text)+" ",1),o("strong",null,"("+h(n(I).filter(z=>z.result_text===p.option_text&&z.step===c._id).length)+")",1)]))),128))]))),128))])]))),128))])):A("",!0)])):A("",!0),Ve,o("div",null,[o("button",{class:"btn btn-primary",onClick:ne}," pane v\xE4rvid lukku ")])])):A("",!0)])}}},je=re(Ge,[["__scopeId","data-v-1478665e"]]);export{je as default};
