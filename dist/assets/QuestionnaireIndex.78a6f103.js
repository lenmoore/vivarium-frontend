import{u as $,d as A,e as V,f as D,g as q,h as n,w as E,o as c,a as d,i as l,t as v,F,j as Q,k as T,n as U,l as H}from"./index.d52b5046.js";const L={class:"h-100 d-flex flex-column overflow-scroll justify-content-between w-100 align-content-around"},M={key:0,class:"game-steps-wrapper w-100 h-100"},N={key:0,class:"w-100 d-flex flex-column justify-content-between h-100"},O={class:"text-center"},W={class:"options-wrapper w-100"},J=["onClick"],K={class:"buttons w-100"},R={key:1},X={key:1,class:"d-flex align-items-center w-100 h-100 justify-content-center"},ee={__name:"QuestionnaireIndex",setup(Y){var S,b,k;const r=$(),u=A(),e=V({game_started:!1,game_loading:!1,current_step:null,step_counter:-1,last_step:!1,visitor_current_step_selected_option_text:""});D(async()=>{await u.fetchVisitor(localStorage.getItem("visitorId")),await r.getGames(),await r.getPhases()});const _=q(()=>r.phases),w=q(()=>r.games);console.log(_);let a=u.fetchVisitor(localStorage.getItem("visitorId")),x={"blue-sky":"orange",fuchsia:"fuchsia",silver:"blue",lime:"green"}[a.confirmed_humanity_value],z=n(_==null?void 0:_.value.find(s=>s.active&&(a.confirmed_humanity_value&&s.phase_game.open_for_colors.includes(x)||a.confirmed_humanity_value==="none")));const f=n((b=(S=z.value)==null?void 0:S.phase_game)==null?void 0:b._id);let t=n(w.value.find(s=>s._id===(f==null?void 0:f.value))),m=n((k=t.value)==null?void 0:k.game_steps);async function C(){var s,o,i;e.game_loading=!0,localStorage.getItem((s=t==null?void 0:t.value)==null?void 0:s._id)==="done"||((o=t==null?void 0:t.value)==null?void 0:o.game_type)==="SHOP"?(alert("Uus faas pole veel alanud. Proovi varsti uuesti"),location.reload()):(console.log(t),localStorage.getItem((i=t==null?void 0:t.value)==null?void 0:i._id)===null?await P():console.log("visitor.quiz_results",a.quiz_results),e.game_started=!0,e.current_step=m.value[0]),h(1)}E(e,async()=>{a=await u.fetchVisitor(localStorage.getItem("visitorId"))});async function P(){var i,p,y,I;await r.getGames(),a=await u.fetchVisitor(localStorage.getItem("visitorId"));let s=n(_==null?void 0:_.value.find(g=>g.active&&(a.confirmed_humanity_value&&g.phase_game.open_for_colors.includes(x)||a.confirmed_humanity_value==="none")));const o=n((p=(i=s.value)==null?void 0:i.phase_game)==null?void 0:p._id);t=n(w.value.find(g=>g._id===(o==null?void 0:o.value))),m=n((y=t.value)==null?void 0:y.game_steps);for(const g of(I=t.value)==null?void 0:I.game_steps)a.quiz_results.push({step:g,result_text:"-",result_humanity_values:{}});console.log("is this where it gets lost?",a),await u.editVisitor(a),localStorage.setItem(t.value._id,"started"),await r.getPhases(),s=V(r.getActivePhase),await r.getGames(),e.game_loading=!1}function j(){localStorage.setItem(t.value._id,"done"),H.push({name:"visitor.quiz.done"})}async function B(s){a=await u.fetchVisitor(localStorage.getItem("visitorId"));let o=n(a);console.log(o);let i=o.value.quiz_results.find(p=>p.step===e.current_step._id);console.log(i),i.result_text=s.option_text,i.result_humanity_values=s.humanity_values,e.visitor_current_step_selected_option_text=s.option_text,a=await u.editVisitor(o.value)}function h(s){e.step_counter+=s,e.step_counter<m.value.length?e.current_step=m.value[e.step_counter]:e.last_step=!0,e.visitor_current_step_selected_option_text=n(a.quiz_results.find(o=>o.step===e.current_step._id).result_text)}return(s,o)=>(c(),d("div",L,[e.game_started?(c(),d("div",M,[e.last_step?(c(),d("div",R,[l("button",{class:"btn btn-primary",onClick:j}," Valmis ")])):(c(),d("div",N,[l("div",null,[l("h4",O,v(e.current_step.question_text),1),l("div",W,[(c(!0),d(F,null,Q(e.current_step.question_options,(i,p)=>(c(),d("div",{key:p,class:U([{selected:e.visitor_current_step_selected_option_text===i.option_text},"option w-100"]),onClick:y=>B(i)},v(i.option_text),11,J))),128))])]),l("div",K,[l("button",{class:"btn btn-outline-primary",onClick:o[0]||(o[0]=i=>h(-1))}," eelmine "),l("span",null,v(e.step_counter+1)+" / "+v(T(t).game_steps.length),1),l("button",{class:"btn btn-primary",onClick:o[1]||(o[1]=i=>h(1))}," jargmine ")])]))])):(c(),d("div",X,[l("button",{class:"w-75 btn btn-primary",onClick:C}," Alusta ")]))]))}};export{ee as default};
